{% extends "base.html" %}

{% block title %}Start Quiz - AI SmartQuizzer{% endblock %}

{% block content %}

<div id="flash-notification" class="flash-notification"></div>


<div id="quiz-setup" class="card">
    <h2>Start a New Quiz</h2>
    <form id="setup-form">
        {% if material_id %}
            <p class="mb-2">Generating quiz from material:</p>
            <h3>{{ material_topic }}</h3>
            <input type="hidden" id="material_id" value="{{ material_id }}">
            <input type="hidden" id="material_topic" value="{{ material_topic }}">
        {% else %}
            <div class="form-group">
                <label for="topic">Topic</label>
                <input type="text" id="topic" class="form-control" value="General Knowledge" required>
            </div>
            <input type="hidden" id="material_id" value="">
            <input type="hidden" id="material_topic" value="">
        {% endif %}

        <div class="form-group mt-2">
            <label for="num_questions">Number of Questions (5-30)</label>
            <input type="number" id="num_questions" class="form-control" value="10" min="5" max="30" required>
        </div>

        <div class="form-group">
            <label for="difficulty">Difficulty</label>
            <select id="difficulty" class="form-control">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
                <option value="mixed">Mixed</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary btn-block">Start Quiz</button>
    </form>
</div>

<div id="quiz-loading" class="card">
    <h2 class="text-center">Generating Your Quiz...</h2>
    <p class="text-center">Please wait while our AI crafts your questions.</p>
    <div class="spinner"></div>
</div>

<div id="quiz-container" class="card">
    <div id="quiz-header">
        <span id="question-progress">Question 1 of 10</span>
        <span id="question-type-display" class="question-type-badge">Type</span>
        <span id="question-timer">Time: 0s</span>
        <span id="current-score">Score: 0</span>
    </div>

    <div id="question-body">
        <h2 id="question-text">This is a sample question?</h2>
        <small id="mcq-multiple-hint" class="text-muted mb-2 d-block" style="display: none;">(Select all that apply)</small>
        <div id="answer-options">
            </div>
    </div>

    <div id="feedback-container" class="card">
         <h3 id="feedback-header">
            <span id="feedback-icon">‚úÖ</span>
            <span id="feedback-text">Correct!</span>
        </h3>
        <p id="feedback-explanation">Explanation...</p>
        <strong id="feedback-hint" style="display: none;">Hint...</strong>

        <form id="question-feedback-form">
             <h3>Report an issue:</h3>
             <div id="feedback-alert" style="display: none;"></div>
             <div class="form-group">
                 <textarea id="feedback-comment" class="form-control" placeholder="e.g., Unclear question, wrong answer..."></textarea>
             </div>
             <div class="form-group">
                 <label><input type="checkbox" id="feedback-flag"> Flag as inappropriate/incorrect</label>
             </div>
             <button type="submit" class="btn btn-secondary btn-sm">Submit Feedback</button>
        </form>
    </div>

    <div id="quiz-footer" class="mt-2">
        <button id="submit-answer" class="btn btn-primary">Submit Answer</button>
        <button id="next-question" class="btn btn-secondary" style="display: none;">Next Question</button>
    </div>
</div>

<div id="quiz-results" class="card">
    <div class="quiz-completion-header">
        <div class="completion-icon">
            <span id="completion-emoji">üéâ</span>
        </div>
        <h2>Quiz Complete!</h2>
        <div class="completion-subtitle">Great job finishing the quiz!</div>
    </div>

    <div class="score-summary">
        <div class="score-circle">
            <div class="score-percentage" id="score-percentage">50%</div>
            <div class="score-fraction" id="score-fraction">5 / 10</div>
        </div>
        <div class="score-details">
            <div class="score-item">
                <span class="score-label">Correct Answers:</span>
                <span class="score-value" id="correct-count">5</span>
            </div>
            <div class="score-item">
                <span class="score-label">Total Questions:</span>
                <span class="score-value" id="total-count">10</span>
            </div>
            <div class="score-item">
                <span class="score-label">Grade:</span>
                <span class="score-value grade" id="grade-display">C</span>
            </div>
            <div class="score-item">
                <span class="score-label">Accuracy:</span>
                <span class="score-value" id="accuracy-score">50%</span>
            </div>
        </div>
    </div>

    <div class="quiz-stats-grid">
        <div class="stat-card">
            <div class="stat-icon">‚è±Ô∏è</div>
            <div class="stat-content">
                <div class="stat-label">Total Time</div>
                <div class="stat-value" id="total-time">2:30</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚ö°</div>
            <div class="stat-content">
                <div class="stat-label">Avg. Time/Question</div>
                <div class="stat-value" id="avg-time-per-question">15s</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-content">
                <div class="stat-label">Completed</div>
                <div class="stat-value" id="completion-timestamp">Today, 3:45 PM</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-content">
                <div class="stat-label">Difficulty</div>
                <div class="stat-value" id="quiz-difficulty">Medium</div>
            </div>
        </div>
    </div>

    <div class="performance-message" id="performance-message">
        <p>You're making good progress! Keep practicing to improve your score.</p>
    </div>

    <div id="ai-feedback-container" class="card">
        <p class="loading">Generating personalized feedback...</p>
    </div>

    <div id="results-review-area">
        <h3>Review Your Answers</h3>
    </div>

    <div id="results-actions">
        <button id="retry-quiz" class="btn btn-secondary">üîÑ Retry This Quiz</button>
        <a href="{{ url_for('index') }}" id="new-quiz" class="btn btn-primary">‚ú® Start New Quiz</a>
        <a href="{{ url_for('profile') }}" class="btn btn-outline">üìä View Analytics</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='quiz.js') }}"></script>
{% endblock %}